= Проектирование витрины в Google BigQuery

Поскольку я уже решил делать в BQ, а не в вертике, чтобы немного изучить
эту область, я вынужден был из-за недостатка времени и знаний пока
опустить многие важные для продуктивного DWH моменты, такие как
ссылочная целостность, проекции, партицирование, главные ключи и пр.

Кроме того, мне понравилась якорная модель как наиболее гибкая и строгая,
хоть и затратная на этапе начального проектирования и внедрения. +
Однако опять же из-за недостатка времени и знаний окунуться полностью в эту модель
я не смог, поэтому также до максимума упростил структуру данного мини-DWH,
чтобы изучить и попробовать основные моменты.

== ETL источник

Репозитории и коммиты

bigquery-public-data.github_repos.sample_repos
bigquery-public-data.github_repos.sample_commits

== Хранилище

Хранилище проектируем по идеологии anchor modeling

Разработка при помощи онлайн-инструмента link:www.anchormodeling.com[]

=== Схема

image::anchormodeling.com/Screenshot_20200217_171835.png[]

=== Особенности Google BigQuery (BQ)

==== Суррогатные ключи

Необходимы для якорной модели, но отсутствуют в BQ. +
Для этого задания заменим их uuid: +
https://cloud.google.com/dataprep/docs/html/Generate-Primary-Keys_57344595
https://cloud.google.com/bigquery/docs/reference/standard-sql/uuid_functions#generate_uuid

==== Констрейнты

В BQ также отсутствует primary key, поэтому упрощаем схему, убирая PK,
будем поддерживать его программно.

В общем, он там и не нужен, т.к. BQ предназначен исключительно для инсертов.
Апдейты там очень жестко ограничивваются.
Да и якорная модель апдейты также не признает.

==== Партицирование, проекции и группировка

Также пока убрал, т.к. в BQ это реализовано немного по-другому и
в тестовом учебном репозитории оно, я думаю, не будет играть никакой существенной роли.

=== Create STAGE table

В случае с bigquery stage и ETL-источник - одно и то же. +
И они уже заполнены.

=== Скрипт для создания DWH

[source, sql]
----
include::./anchormodeling.com/create.sql[]
----

== Заполнение DWH

